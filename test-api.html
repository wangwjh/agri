<!DOCTYPE html>
<html>
<head>
    <title>å†œä¸šæ•°æ®å¹³å° API æµ‹è¯•</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .container { max-width: 800px; margin: 0 auto; }
        .test-result { 
            margin: 10px 0; 
            padding: 10px; 
            border-radius: 5px; 
            border-left: 4px solid;
        }
        .success { background: #f0f9ff; border-color: #0ea5e9; }
        .error { background: #fef2f2; border-color: #ef4444; }
        .loading { background: #fffbeb; border-color: #f59e0b; }
        button { 
            padding: 10px 20px; 
            margin: 5px; 
            border: none; 
            border-radius: 5px; 
            background: #3b82f6; 
            color: white; 
            cursor: pointer; 
        }
        button:hover { background: #2563eb; }
        pre { background: #f3f4f6; padding: 10px; border-radius: 5px; overflow-x: auto; }
    </style>
</head>
<body>
    <div class="container">
        <h1>å†œä¸šæ•°æ®å¹³å° API æµ‹è¯•</h1>
        
        <div id="results"></div>
        
        <h2>æµ‹è¯•æ“ä½œ</h2>
        <button onclick="testBasicConnection()">æµ‹è¯•åŸºç¡€è¿æ¥</button>
        <button onclick="testAdminStats()">æµ‹è¯•ç®¡ç†ç»Ÿè®¡</button>
        <button onclick="testAssetStats()">æµ‹è¯•èµ„äº§ç»Ÿè®¡</button>
        <button onclick="testAdminLogin()">æµ‹è¯•ç®¡ç†å‘˜ç™»å½•</button>
        <button onclick="clearResults()">æ¸…ç©ºç»“æœ</button>
        
        <h2>æ‰‹åŠ¨è¾“å…¥æµ‹è¯•</h2>
        <input type="text" id="customUrl" placeholder="è¾“å…¥APIè·¯å¾„ (å¦‚: /api/admin/stats)" style="width: 300px; padding: 5px;">
        <button onclick="testCustomUrl()">æµ‹è¯•è‡ªå®šä¹‰URL</button>
    </div>

    <script>
        const resultsDiv = document.getElementById('results');
        
        function addResult(message, type = 'loading') {
            const div = document.createElement('div');
            div.className = `test-result ${type}`;
            div.innerHTML = message;
            resultsDiv.appendChild(div);
            resultsDiv.scrollTop = resultsDiv.scrollHeight;
        }
        
        function clearResults() {
            resultsDiv.innerHTML = '';
        }
        
        async function makeRequest(url, options = {}) {
            try {
                const response = await fetch(`http://localhost:8080${url}`, {
                    ...options,
                    headers: {
                        'Content-Type': 'application/json',
                        ...options.headers
                    }
                });
                
                const data = await response.text();
                let parsedData;
                try {
                    parsedData = JSON.parse(data);
                } catch (e) {
                    parsedData = data;
                }
                
                return {
                    status: response.status,
                    statusText: response.statusText,
                    data: parsedData
                };
            } catch (error) {
                throw error;
            }
        }
        
        async function testBasicConnection() {
            addResult('ğŸ”— æµ‹è¯•åŸºç¡€è¿æ¥...', 'loading');
            try {
                const result = await makeRequest('/');
                addResult(`âœ… åŸºç¡€è¿æ¥æˆåŠŸ (${result.status}): ${result.statusText}`, 'success');
            } catch (error) {
                addResult(`âŒ åŸºç¡€è¿æ¥å¤±è´¥: ${error.message}`, 'error');
            }
        }
        
        async function testAdminLogin() {
            addResult('ğŸ” æµ‹è¯•ç®¡ç†å‘˜ç™»å½•...', 'loading');
            try {
                const result = await makeRequest('/api/auth/login', {
                    method: 'POST',
                    body: JSON.stringify({
                        username: 'admin',
                        password: 'admin123'
                    })
                });
                
                if (result.status === 200 && result.data.success) {
                    localStorage.setItem('testToken', result.data.data.token);
                    addResult(`âœ… ç®¡ç†å‘˜ç™»å½•æˆåŠŸ<br><pre>${JSON.stringify(result.data, null, 2)}</pre>`, 'success');
                } else {
                    addResult(`âš ï¸ ç™»å½•å“åº”å¼‚å¸¸ (${result.status})<br><pre>${JSON.stringify(result, null, 2)}</pre>`, 'error');
                }
            } catch (error) {
                addResult(`âŒ ç®¡ç†å‘˜ç™»å½•å¤±è´¥: ${error.message}`, 'error');
            }
        }
        
        async function testAdminStats() {
            addResult('ğŸ“Š æµ‹è¯•ç®¡ç†ç»Ÿè®¡ API...', 'loading');
            const token = localStorage.getItem('testToken');
            
            if (!token) {
                addResult('âš ï¸ è¯·å…ˆç™»å½•è·å–token', 'error');
                return;
            }
            
            try {
                const result = await makeRequest('/api/admin/stats', {
                    headers: {
                        'Authorization': `Bearer ${token}`
                    }
                });
                
                if (result.status === 200) {
                    addResult(`âœ… ç®¡ç†ç»Ÿè®¡æˆåŠŸ<br><pre>${JSON.stringify(result.data, null, 2)}</pre>`, 'success');
                } else {
                    addResult(`âŒ ç®¡ç†ç»Ÿè®¡å¤±è´¥ (${result.status})<br><pre>${JSON.stringify(result, null, 2)}</pre>`, 'error');
                }
            } catch (error) {
                addResult(`âŒ ç®¡ç†ç»Ÿè®¡å¤±è´¥: ${error.message}`, 'error');
            }
        }
        
        async function testAssetStats() {
            addResult('ğŸ“ˆ æµ‹è¯•èµ„äº§ç»Ÿè®¡ API...', 'loading');
            const token = localStorage.getItem('testToken');
            
            if (!token) {
                addResult('âš ï¸ è¯·å…ˆç™»å½•è·å–token', 'error');
                return;
            }
            
            try {
                const result = await makeRequest('/api/admin/assets/stats', {
                    headers: {
                        'Authorization': `Bearer ${token}`
                    }
                });
                
                if (result.status === 200) {
                    addResult(`âœ… èµ„äº§ç»Ÿè®¡æˆåŠŸ<br><pre>${JSON.stringify(result.data, null, 2)}</pre>`, 'success');
                } else {
                    addResult(`âŒ èµ„äº§ç»Ÿè®¡å¤±è´¥ (${result.status})<br><pre>${JSON.stringify(result, null, 2)}</pre>`, 'error');
                }
            } catch (error) {
                addResult(`âŒ èµ„äº§ç»Ÿè®¡å¤±è´¥: ${error.message}`, 'error');
            }
        }
        
        async function testCustomUrl() {
            const url = document.getElementById('customUrl').value;
            if (!url) {
                addResult('âš ï¸ è¯·è¾“å…¥URL', 'error');
                return;
            }
            
            addResult(`ğŸ” æµ‹è¯•è‡ªå®šä¹‰URL: ${url}...`, 'loading');
            const token = localStorage.getItem('testToken');
            
            try {
                const result = await makeRequest(url, {
                    headers: token ? {
                        'Authorization': `Bearer ${token}`
                    } : {}
                });
                
                if (result.status < 400) {
                    addResult(`âœ… è¯·æ±‚æˆåŠŸ (${result.status})<br><pre>${JSON.stringify(result.data, null, 2)}</pre>`, 'success');
                } else {
                    addResult(`âŒ è¯·æ±‚å¤±è´¥ (${result.status})<br><pre>${JSON.stringify(result, null, 2)}</pre>`, 'error');
                }
            } catch (error) {
                addResult(`âŒ è¯·æ±‚å¤±è´¥: ${error.message}`, 'error');
            }
        }
        
        // é¡µé¢åŠ è½½æ—¶è‡ªåŠ¨æµ‹è¯•åŸºç¡€è¿æ¥
        window.onload = function() {
            testBasicConnection();
        };
    </script>
</body>
</html> 